# YOLO å¾®ä¿¡çº¢åŒ…è‡ªåŠ¨æŠ¢å¤ºå™¨

åŸºäº YOLOv26s æ·±åº¦å­¦ä¹ ç›®æ ‡æ£€æµ‹çš„è·¨å¹³å°å¾®ä¿¡çº¢åŒ…è‡ªåŠ¨æŠ¢å¤ºå·¥å…·ã€‚

## é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®ä½¿ç”¨ YOLOv26s ç›®æ ‡æ£€æµ‹æ¨¡å‹ï¼Œç»“åˆå®æ—¶å±å¹•æ•è·å’Œè‡ªåŠ¨åŒ–æ“ä½œæŠ€æœ¯ï¼Œå®ç°å¾®ä¿¡çº¢åŒ…çš„è‡ªåŠ¨è¯†åˆ«ã€å®šä½å’ŒæŠ¢å¤ºåŠŸèƒ½ã€‚é¡¹ç›®é‡‡ç”¨æ¨¡å—åŒ–è®¾è®¡ï¼Œæ”¯æŒ Windowsã€macOS å’Œ Linux ä¸‰å¤§å¹³å°ï¼Œæä¾›å®Œå–„çš„å›¾å½¢ç”¨æˆ·ç•Œé¢ã€æ•°æ®æ ‡æ³¨å·¥å…·å’Œæ¨¡å‹è®­ç»ƒæµç¨‹ã€‚

## æ ¸å¿ƒåŠŸèƒ½

### ä¸»ç¨‹åºåŠŸèƒ½
- ğŸ¯ **å®æ—¶ç›®æ ‡æ£€æµ‹** - ä½¿ç”¨ YOLOv8 æ¨¡å‹å¿«é€Ÿæ£€æµ‹çº¢åŒ…ã€å¼€æŒ‰é’®ç­‰ 7 ç±»å…ƒç´ 
- ğŸ–¥ï¸ **è·¨å¹³å°æ”¯æŒ** - Windowsï¼ˆæœ€ä½³æ”¯æŒï¼‰ã€macOSã€Linux å…¨å¹³å°å…¼å®¹
- ğŸ¨ **å›¾å½¢åŒ–ç•Œé¢** - åŸºäº Tkinter çš„ç›´è§‚ç”¨æˆ·ç•Œé¢
- âš¡ **é«˜æ•ˆå±å¹•æ•è·** - ä½¿ç”¨ mss å®ç°é«˜æ€§èƒ½å±å¹•å½•åˆ¶
- ğŸ“ **çª—å£ç®¡ç†** - è‡ªåŠ¨å®šä½å¾®ä¿¡çª—å£ï¼Œæ”¯æŒè‡ªå®šä¹‰åŒºåŸŸé€‰æ‹©
- ğŸ”§ **çµæ´»é…ç½®** - YAML é…ç½®æ–‡ä»¶è‡ªå®šä¹‰å‚æ•°
- ğŸ® **ä¸‰çº§ä¼˜å…ˆçº§æ£€æµ‹** - å¼€æŒ‰é’® > çº¢åŒ… > è¿”å›/å…³é—­æŒ‰é’®
- ğŸ”„ **æ™ºèƒ½è¿”å›** - è‡ªåŠ¨è¿”å›èŠå¤©ç•Œé¢ç»§ç»­ç›‘æ§
- ğŸ“Š **å®æ—¶æ€§èƒ½ç›‘æ§** - FPSã€æ¨ç†æ—¶é—´ã€æ•è·æ—¶é—´æ˜¾ç¤º

### è¾…åŠ©å·¥å…·
- ğŸ“ **æ•°æ®æ ‡æ³¨å·¥å…·** - å†…ç½®æ ‡æ³¨å·¥å…·ï¼Œæ”¯æŒ YOLO æ ¼å¼å¯¼å‡º
- ğŸš€ **æ¨¡å‹è®­ç»ƒ** - å®Œæ•´çš„è®­ç»ƒæµç¨‹å’Œæœ€ä½³å®è·µå‚æ•°
- ğŸ“ **æ•°æ®é›†æ•´ç†** - è‡ªåŠ¨åˆ’åˆ†è®­ç»ƒé›†/éªŒè¯é›†ï¼Œæ•°æ®å¢å¼º

## æŠ€æœ¯æ ˆ

### æ ¸å¿ƒä¾èµ–
| æŠ€æœ¯/åº“ | ç‰ˆæœ¬ | ç”¨é€” |
|---------|------|------|
| Python | 3.10+ | å¼€å‘è¯­è¨€ |
| ultralytics | 8.2.0+ | YOLO ç›®æ ‡æ£€æµ‹æ¡†æ¶ |
| OpenCV | 4.8.0+ | å›¾åƒå¤„ç† |
| PyTorch | 2.0.0+ | æ·±åº¦å­¦ä¹ æ¡†æ¶ |
| NumPy | 1.24.0+ | æ•°å€¼è®¡ç®— |
| Pillow | 10.0.0+ | å›¾åƒå¤„ç† |

### GUI å’Œè‡ªåŠ¨åŒ–
| æŠ€æœ¯/åº“ | ç”¨é€” |
|---------|------|
| Tkinter | å›¾å½¢ç”¨æˆ·ç•Œé¢ |
| pyautogui | é¼ æ ‡é”®ç›˜è‡ªåŠ¨åŒ– |
| mss | é«˜æ€§èƒ½å±å¹•æ•è· |

### å¹³å°ç‰¹å®š
- **Windows**: win32api, win32con, win32gui (çª—å£ç®¡ç†ã€å…¨å±€çƒ­é”®)
- **macOS**: AppKit, Quartz (çª—å£ç®¡ç†)
- **Linux**: python-xlib (çª—å£ç®¡ç†)

### å…¶ä»–
- PyYAMLï¼šé…ç½®æ–‡ä»¶ç®¡ç†
- æ”¯æŒç¡¬ä»¶åŠ é€Ÿï¼šCUDAã€MPS (Apple Silicon)ã€RKNPU (Rockchip)

## æ£€æµ‹ç±»åˆ«

æ¨¡å‹å¯ä»¥æ£€æµ‹ä»¥ä¸‹ 7 ä¸ªç±»åˆ«ï¼š

| ID | ç±»åˆ«åç§° | æè¿° | é¢œè‰² | ä¼˜å…ˆçº§ |
|----|---------|------|------|--------|
| 0 | red_packet | çº¢åŒ…å°é¢ | ç»¿è‰² | 2 |
| 1 | open_button | å¼€çº¢åŒ…æŒ‰é’® | çº¢è‰² | 1ï¼ˆæœ€é«˜ï¼‰ |
| 2 | amount_text | é‡‘é¢æ–‡å­— | è“è‰² | - |
| 3 | close_button | å…³é—­æŒ‰é’® | é»„è‰² | 3 |
| 4 | back_button | è¿”å›æŒ‰é’® | æ©™è‰² | 3 |
| 5 | opened_red_packet | å·²æ‹†å¼€çš„çº¢åŒ… | ç°è‰² | - |
| 6 | play_button | æ’­æ”¾æŒ‰é’® | é’è‰² | - |

## å®‰è£…ä¸é…ç½®

### ç¯å¢ƒè¦æ±‚
- Python 3.10 æˆ–æ›´é«˜ç‰ˆæœ¬
- æ”¯æŒ CUDA çš„ GPUï¼ˆæ¨èï¼Œç”¨äºåŠ é€Ÿæ¨ç†ï¼‰
- å¾®ä¿¡å®‰å“ç‰ˆ*æ¨¡æ‹Ÿå™¨
- è‡³å°‘ 4GB RAMï¼ˆæ¨è 8GB+ï¼‰
- 10GB å¯ç”¨ç£ç›˜ç©ºé—´

### å®‰è£…æ­¥éª¤

```bash
# 1. å…‹éš†ä»“åº“
git clone https://github.com/hczxpaul/yolo-redpocket.git
cd yolo-redpocket

# 2. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼ˆæ¨èï¼‰
python -m venv venv

# 3. æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
# Windows:
venv\Scripts\activate
# macOS/Linux:
source venv/bin/activate

# 4. å®‰è£…é€šç”¨ä¾èµ–
pip install -r requirements.txt

# 5. å®‰è£…å¹³å°ç‰¹å®šä¾èµ–
# Windows:
pip install -r requirements-windows.txt
# macOS:
pip install -r requirements-macos.txt
# Linux:
pip install -r requirements-linux.txt
```

### æ¨¡å‹å‡†å¤‡

å°†è®­ç»ƒå¥½çš„æ¨¡å‹æ–‡ä»¶æ”¾ç½®åœ¨ `models/` ç›®å½•ä¸‹ï¼Œé»˜è®¤æ¨¡å‹è·¯å¾„ä¸º `models/best.pt`ã€‚

å¦‚éœ€è®­ç»ƒè‡ªå·±çš„æ¨¡å‹ï¼Œè¯·å‚è€ƒ[æ¨¡å‹è®­ç»ƒ](#æ¨¡å‹è®­ç»ƒ)ç« èŠ‚ã€‚

## ä½¿ç”¨æŒ‡å—

### å¯åŠ¨ä¸»ç¨‹åº

```bash
python main.py
```

#### ä¸»ç¨‹åºä½¿ç”¨æµç¨‹

1. **é€‰æ‹©ç›‘æ§çª—å£**
   - ç‚¹å‡»"ç‚¹å‡»é€‰æ‹©çª—å£"æŒ‰é’®
   - åœ¨å…¨å±é€‰æ‹©ç•Œé¢ä¸­ç‚¹å‡»å¾®ä¿¡çª—å£
   - æˆ–æŒ‰ ESC å–æ¶ˆé€‰æ‹©

2. **åŠ è½½æ¨¡å‹**
   - ç‚¹å‡»"åŠ è½½æ¨¡å‹"æŒ‰é’®
   - é€‰æ‹©è®­ç»ƒå¥½çš„ .pt æ¨¡å‹æ–‡ä»¶
   - æˆ–ä½¿ç”¨é»˜è®¤æ¨¡å‹ `models/best.pt`

3. **å¼€å§‹ç›‘æ§**
   - ç‚¹å‡»"å¼€å§‹ç›‘æ§"æŒ‰é’®
   - å¾®ä¿¡çª—å£ä¼šè‡ªåŠ¨ç½®é¡¶
   - å³ä¾§é¢„è§ˆåŒºåŸŸæ˜¾ç¤ºå®æ—¶æ£€æµ‹ç»“æœ

4. **å¼€å§‹æŠ¢çº¢åŒ…**
   - ç‚¹å‡»"å¼€å§‹æŠ¢çº¢åŒ…"æŒ‰é’®å¯ç”¨è‡ªåŠ¨æ¨¡å¼
   - æˆ–æŒ‰ **F9** é”®ï¼ˆå…¨å±€/çª—å£å†…å¿«æ·é”®ï¼‰æš‚åœ/æ¢å¤
   - ç¨‹åºä¼šæŒ‰ä¼˜å…ˆçº§è‡ªåŠ¨ç‚¹å‡»æ£€æµ‹åˆ°çš„ç›®æ ‡

#### å¿«æ·é”®

| å¿«æ·é”® | åŠŸèƒ½ | å¹³å° |
|--------|------|------|
| F9 | æš‚åœ/æ¢å¤æŠ¢çº¢åŒ… | å…¨éƒ¨ï¼ˆWindows æ”¯æŒå…¨å±€ï¼‰ |

#### æ£€æµ‹ä¼˜å…ˆçº§

1. **æœ€é«˜ä¼˜å…ˆçº§**ï¼šå¼€çº¢åŒ…æŒ‰é’® (open_button) - ç«‹å³è¿ç»­ç‚¹å‡»
2. **ç¬¬äºŒä¼˜å…ˆçº§**ï¼šçº¢åŒ…å°é¢ (red_packet) - ç‚¹å‡»æ‰“å¼€çº¢åŒ…
3. **ç¬¬ä¸‰ä¼˜å…ˆçº§**ï¼šè¿”å›/å…³é—­æŒ‰é’® - ç‚¹å‡»è¿”å›èŠå¤©ç•Œé¢

### ä½¿ç”¨æ ‡æ³¨å·¥å…·

```bash
python labeling_tool.py
```

**åŠŸèƒ½ï¼š**
- åŠ è½½å›¾åƒæ•°æ®é›†
- ç»˜åˆ¶è¾¹ç•Œæ¡†æ ‡æ³¨
- æ”¯æŒ 7 ä¸ªç±»åˆ«é€‰æ‹©
- å¯¼å‡º YOLO æ ¼å¼æ ‡æ³¨
- æ ‡æ³¨è´¨é‡æ£€æŸ¥å’Œä¿®å¤

### æ¨¡å‹è®­ç»ƒ

```bash
python train_with_best_practices.py
```

**è®­ç»ƒç‰¹æ€§ï¼š**
- é¢„é…ç½®çš„æœ€ä½³è®­ç»ƒå‚æ•°
- è‡ªåŠ¨ç¡¬ä»¶åŠ é€Ÿæ£€æµ‹ï¼ˆCUDA/MPS/RKNPUï¼‰
- å®Œæ•´çš„æ•°æ®å¢å¼ºï¼ˆmosaicã€mixupã€copy_pasteï¼‰
- AdamW ä¼˜åŒ–å™¨ + ä½™å¼¦å­¦ä¹ ç‡è°ƒåº¦
- æ—©åœæœºåˆ¶ (patience=60)
- è‡ªåŠ¨éªŒè¯å’ŒæŒ‡æ ‡è®°å½•
- æœ€ä½³æ¨¡å‹è‡ªåŠ¨ä¿å­˜

**è®­ç»ƒè¾“å‡ºï¼š**
- æœ€ä½³æ¨¡å‹ï¼š`models/best.pt`
- å¸¦æ—¶é—´æˆ³çš„æ¨¡å‹ï¼š`models/yolo26s_best_latest.pt`
- è®­ç»ƒé…ç½®ï¼š`models/yolo26s_best_config.yaml`

### æ•´ç†æ•°æ®é›†

```bash
python organize_dataset.py
```

**åŠŸèƒ½ï¼š**
- æŒ‰æ¯”ä¾‹åˆ’åˆ†è®­ç»ƒé›†/éªŒè¯é›†
- æ•°æ®å¢å¼º
- æ ¼å¼è½¬æ¢

## é¡¹ç›®ç»“æ„

```
yolo-redpocket/
â”œâ”€â”€ main.py                          # ä¸»ç¨‹åºå…¥å£
â”œâ”€â”€ labeling_tool.py                 # æ•°æ®æ ‡æ³¨å·¥å…·
â”œâ”€â”€ platform_adapter.py              # è·¨å¹³å°é€‚é…å±‚
â”œâ”€â”€ config_utils.py                  # é…ç½®å·¥å…·
â”œâ”€â”€ train_with_best_practices.py     # æ¨¡å‹è®­ç»ƒè„šæœ¬
â”œâ”€â”€ organize_dataset.py              # æ•°æ®é›†æ•´ç†è„šæœ¬
â”œâ”€â”€ config.yaml                      # é¡¹ç›®é…ç½®æ–‡ä»¶
â”œâ”€â”€ dataset.yaml                     # æ•°æ®é›†é…ç½®æ–‡ä»¶
â”œâ”€â”€ requirements.txt                 # é€šç”¨ä¾èµ–
â”œâ”€â”€ requirements-windows.txt         # Windows å¹³å°ä¾èµ–
â”œâ”€â”€ requirements-macos.txt           # macOS å¹³å°ä¾èµ–
â”œâ”€â”€ requirements-linux.txt           # Linux å¹³å°ä¾èµ–
â”œâ”€â”€ .gitignore                       # Git å¿½ç•¥æ–‡ä»¶
â”œâ”€â”€ LICENSE                          # MIT è®¸å¯è¯
â”œâ”€â”€ README.md                        # é¡¹ç›®è¯´æ˜æ–‡æ¡£ï¼ˆæœ¬æ–‡ä»¶ï¼‰
â”œâ”€â”€ dataset/                         # æ•°æ®é›†ç›®å½•ï¼ˆGit å¿½ç•¥ï¼‰
â”‚   â”œâ”€â”€ images/
â”‚   â”‚   â”œâ”€â”€ train/                   # è®­ç»ƒé›†å›¾åƒ
â”‚   â”‚   â””â”€â”€ val/                     # éªŒè¯é›†å›¾åƒ
â”‚   â””â”€â”€ labels/
â”‚       â”œâ”€â”€ train/                   # è®­ç»ƒé›†æ ‡æ³¨
â”‚       â””â”€â”€ val/                     # éªŒè¯é›†æ ‡æ³¨
â”œâ”€â”€ models/                          # æ¨¡å‹ç›®å½•ï¼ˆGit å¿½ç•¥ï¼‰
â”‚   â”œâ”€â”€ best.pt                      # æœ€ä½³æ¨¡å‹æƒé‡
â”‚   â””â”€â”€ yolo26s_best_latest.pt      # æœ€æ–°æ¨¡å‹å¤‡ä»½
â””â”€â”€ runs/                            # è®­ç»ƒå’ŒéªŒè¯ç»“æœï¼ˆGit å¿½ç•¥ï¼‰
    â”œâ”€â”€ detect/                      # æ£€æµ‹ç»“æœ
    â””â”€â”€ train/                       # è®­ç»ƒç»“æœ
```

## åŠŸèƒ½æ¨¡å—ä»‹ç»

### æ ¸å¿ƒç±» (main.py)

#### 1. LoggerHandler
è‡ªå®šä¹‰æ—¥å¿—å¤„ç†å™¨ï¼Œå°†æ—¥å¿—è¾“å‡ºåˆ° Tkinter æ–‡æœ¬æ§ä»¶ï¼Œæ”¯æŒçº¿ç¨‹å®‰å…¨æ“ä½œã€‚

#### 2. ScreenCapture
å±å¹•æ•è·å’Œçª—å£ç®¡ç†ç±»ï¼Œæä¾›è·¨å¹³å°æ”¯æŒï¼š
- `find_wechat_window()` - è‡ªåŠ¨æŸ¥æ‰¾å¾®ä¿¡çª—å£
- `set_window_by_point()` - é€šè¿‡åæ ‡é€‰æ‹©çª—å£ï¼ˆWindowsï¼‰
- `capture_window()` - æ•è·çª—å£å†…å®¹
- `bring_window_to_front()` - å°†çª—å£å¸¦åˆ°å‰å°
- `set_always_on_top()` - è®¾ç½®çª—å£ç½®é¡¶

#### 3. RedPocketDetector
çº¢åŒ…æ£€æµ‹å™¨ç±»ï¼Œä½¿ç”¨ YOLO æ¨¡å‹è¿›è¡Œç›®æ ‡æ£€æµ‹ï¼š
- `load_model()` - åŠ è½½ YOLO æ¨¡å‹
- `detect()` - æ‰§è¡Œç›®æ ‡æ£€æµ‹
- `find_red_packets()` / `find_open_button()` ç­‰ - æŸ¥æ‰¾ç‰¹å®šç±»åˆ«
- è‡ªåŠ¨æ£€æµ‹æœ€ä½³è®¾å¤‡ï¼šCUDA > MPS > RKNPU > CPU

#### 4. AutoClicker
è‡ªåŠ¨ç‚¹å‡»ç±»ï¼š
- `click_at_position()` - ç‚¹å‡»æŒ‡å®šä½ç½®
- `click_center()` - ç‚¹å‡»è¾¹ç•Œæ¡†ä¸­å¿ƒ
- åŒåç«¯æ”¯æŒï¼šwin32apiï¼ˆWindowsï¼‰æˆ– pyautoguiï¼ˆè·¨å¹³å°ï¼‰

#### 5. DataLabeler
æ•°æ®æ ‡æ³¨è¾…åŠ©ç±»ï¼š
- `save_image()` - ä¿å­˜æˆªå›¾
- `save_label()` - ä¿å­˜ YOLO æ ¼å¼æ ‡æ³¨

#### 6. RedPocketApp
ä¸»åº”ç”¨ç¨‹åºç±»ï¼ŒåŒ…å«å®Œæ•´çš„ GUIï¼š
- æ§åˆ¶é¢æ¿ï¼ˆçŠ¶æ€ã€æ¨¡å‹ã€ç›‘æ§ã€çª—å£é€‰æ‹©ï¼‰
- å®æ—¶é¢„è§ˆï¼ˆå¸¦æ£€æµ‹æ¡†å åŠ ï¼‰
- æ—¥å¿—æ˜¾ç¤º
- æ•°æ®æ ‡æ³¨åŠŸèƒ½
- æ¨¡å‹è®­ç»ƒé…ç½®

### è·¨å¹³å°é€‚é…å±‚ (platform_adapter.py)

#### åŸºç±»ï¼šPlatformAdapter
å®šä¹‰ç»Ÿä¸€çš„æ¥å£ï¼š
- `find_target_window()` - æŸ¥æ‰¾ç›®æ ‡çª—å£
- `bring_window_to_front()` - æ¿€æ´»çª—å£
- `get_window_rect()` - è·å–çª—å£ä½ç½®

#### å®ç°ç±»
- **WindowsAdapter** - ä½¿ç”¨ win32guiï¼ˆå®Œæ•´æ”¯æŒï¼‰
- **MacOSAdapter** - ä½¿ç”¨ AppKit/Quartz
- **LinuxAdapter** - ä½¿ç”¨ python-xlib

### é…ç½®å·¥å…· (config_utils.py)
- `load_classes_from_config()` - ä» dataset.yaml åŠ è½½ç±»åˆ«åç§°
- æ”¯æŒå­—å…¸æ ¼å¼å’Œåˆ—è¡¨æ ¼å¼çš„ names å­—æ®µ
- è‡ªåŠ¨å›é€€åˆ°é»˜è®¤ç±»åˆ«

## é…ç½®å‚æ•°è¯´æ˜

### config.yaml

```yaml
project:
  name: å¾®ä¿¡çº¢åŒ…è‡ªåŠ¨æŠ¢å¤ºå™¨ - YOLOç‰ˆ
  version: 2.0.0
  author: RedPocket Team

model:
  default_path: models/best.pt
  default_size: s
  classes:
    - red_packet
    - open_button
    - amount_text
    - close_button
    - back_button
    - opened_red_packet

class_colors:
  red_packet: [0, 255, 0]
  open_button: [255, 0, 0]
  amount_text: [0, 0, 255]
  close_button: [255, 255, 0]
  back_button: [255, 128, 0]
  opened_red_packet: [128, 128, 128]

detection:
  default_confidence: 0.5
  iou_threshold: 0.7

training:
  default_epochs: 100
  default_batch: 16
  default_imgsz: 640
  default_patience: 30
  workers: 8
  amp: true

ui:
  window_width: 1600
  window_height: 1000
  min_window_width: 1400
  min_window_height: 900
  background_color: "#f0f0f0"

paths:
  dataset: dataset
  models: models
  runs: runs
  logs: logs
```

### dataset.yaml

```yaml
path: ./dataset
train: images/train
val: images/val

names:
  0: red_packet
  1: open_button
  2: amount_text
  3: close_button
  4: back_button
  5: opened_red_packet
  6: play_button
```

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - è¯¦è§ [LICENSE](./LICENSE) æ–‡ä»¶ã€‚

## å…è´£å£°æ˜

âš ï¸ **é‡è¦æç¤ºï¼š**

æœ¬é¡¹ç›®ä»…ä¾›å­¦ä¹ å’Œç ”ç©¶ç›®çš„ä½¿ç”¨ã€‚è¯·å‹¿å°†æœ¬å·¥å…·ç”¨äºå•†ä¸šç”¨é€”æˆ–è¿åå¾®ä¿¡æœåŠ¡æ¡æ¬¾çš„è¡Œä¸ºã€‚ä½¿ç”¨æœ¬å·¥å…·æ‰€äº§ç”Ÿçš„ä¸€åˆ‡åæœç”±ä½¿ç”¨è€…è‡ªè¡Œæ‰¿æ‹…ã€‚

è¯·åˆç†ä½¿ç”¨ï¼Œå°Šé‡ä»–äººæƒç›Šï¼Œéµå®ˆç›¸å…³æ³•å¾‹æ³•è§„ã€‚

## è”ç³»æ–¹å¼

- GitHub: [https://github.com/hczxpaul/yolo-redpocket](https://github.com/hczxpaul/yolo-redpocket)
- Issues: [GitHub Issues](https://github.com/hczxpaul/yolo-redpocket/issues)

---
